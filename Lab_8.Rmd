---
title: "Sequence Alignment, Phylogenetic Analysis and Tree Visualization"
output: html_document
---


```{r, message=FALSE}
library(tidyverse)
library(ggtree)
```

# Exercise

1. Use NGPhylogeny.fr to analysis the set of rRNA sequence provided. Describe the methods and put the.png file from your analysis into your Lab 8 .Rmd file


![](Images/tree_00_Lab8.png){width=25%}
```{r}

```

3. Go through the tutorial on
Visualizing and Annotating Phylogenetic Trees with R+ggtree
(https://4va.github.io/biodatasci/r-ggtree.html)
adding the steps to your .Rmd ÙÄÉùle.

## Visualizing and Annotating PhylogeneticTrees with R+ggtree

Horizontal dimension- genetic change
branches- evolutionary lineages changing over time (longer the branch larger the change)
units- nucleotide substitutions per site

```{r}
tree <- read.tree("data/tree_newick.nwk")
tree

tree %>% ggplot()+
  geom_tree()+
  theme_tree()+
  labs(title="Plotting with ggplot")

tree %>% ggtree()+
  theme_tree2()+
  labs(title="Phylogram")

tree %>% ggtree(branch.length = "none") +labs(title= "Cladogram")

tree %>% ggtree(branch.length = "none", color="blue", size= 2, linetype=3) +
  labs(title= "Cladogram with aes")

```

## ** Exercise 1**

1. Create a slanted phylogenetic tree.
```{r}

tree %>% ggtree(layout = "slanted")+
  theme_tree2()
```
2. Create a circular phylogenetic tree
```{r}
tree %>% ggtree(layout = "circular")+
  theme_tree2()
```

3. Create a circular unscaled cladogram with thick red lines

```{r}
tree %>% ggtree(branch.length = "none", color="red", layout = "circular", linetype=1, size=1)
```

```{r}
p <- tree %>% ggtree()+
  geom_nodepoint()+
  geom_tippoint()+
  geom_tiplab()
print(p)
```
## ** Exercise 2**


```{r}
p <- tree %>% ggtree()+
  geom_nodepoint(alpha=0.5, size=2.5, color="orange")+
  geom_tippoint(shape=23, fill="red", color="red")+
  geom_tiplab(color= "purple")+
  ggtitle("Phylogenetic Aesthetics")
print(p)
```
## Internal Node Number

```{r}
tree %>% ggtree()+
  geom_text(aes(label=node), hjust=-.3)
```
Most recent common ancestor (MRCA)

Finding th emost recent common ancestor between C and E
```{r}
tree %>% ggtree()+
  geom_tiplab()

MRCA(tree, .node1="C",.node2 ="E")

MRCA(tree, .node1="G",.node2 ="H")


```
## Labeling Clades

Annotating the most recent common ancestor between taxa C and E
```{r}
tree %>% ggtree()+
  #geom_tiplab()+
   #geom_text(aes(label=node), hjust=-.3)+
  geom_cladelabel(node=17, label="Label for clade from node 17", color = "red")
```

```{r}
tree %>% ggtree()+
  geom_tiplab()+
   #geom_text(aes(label=node), hjust=-.3)+
  geom_cladelabel(node=17, label="Label for clade from node 17", color = "red", offset=1)
```

Adding another clade label connecting taxa G and H (node 21)

```{r}
tree %>% ggtree()+
  geom_tiplab()+
   #geom_text(aes(label=node), hjust=-.3)+
  geom_cladelabel(node=17, label="Label for clade from node 17", color = "red", offset=1, align=TRUE)+
  geom_cladelabel(node=21, label="Label for clade from node 17", color = "red", offset=1, align=TRUE)+
  theme_tree2()+
  xlim(0,70)+
  theme_tree()
  
```
##Highlighting a clade

```{r}
tree %>% ggtree()+
  geom_tiplab()+
  geom_highlight(node=17, fill="gold")+
  geom_highlight(node=21, fill="purple")
```

## Connecting Taxa

```{r}
tree %>% ggtree()+
  geom_tiplab()+
  geom_taxalink("E", "H", color="blue3")+
  geom_taxalink("C", "G", color="orange2", curvature=-.9)
```

## **Exercise 3**

First, find what the MRCA is for taxa B+C, and taxa L+J. You can do this in one of two ways:
Easiest: use MRCA(tree, tip=c("taxon1", "taxon2")) for B/C and L/J separately.

```{r}
BC_MRCA <-MRCA(tree, .node1="B", .node2 = "C")

print(paste("MRCA of BC = ", BC_MRCA))


LJ_MRCA <-MRCA(tree, .node1="L", .node2 = "J")

print(paste("MRCA of LJ = ", LJ_MRCA))

```



```{r}
tree %>% ggtree()+
  geom_tiplab()+
  geom_highlight(node = 19, fill ="gold")+
  geom_highlight(node = 23, fill ="skyblue")+
  geom_cladelabel(node=17,  label= "Superclade (node 17)", color= "gold", offset=0.8)+
  geom_taxalink("C", "E", color="grey", linetype=2)+
  geom_taxalink("G", "J", color="grey", linetype=2)+
  theme_tree2()+
  labs(title= " The phylogenetic tree for exercise 3")
  

```

# Advanced Tree Annotations
